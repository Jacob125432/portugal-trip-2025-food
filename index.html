<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Algarve + Lizbona — Mapa atrakcji i restauracji (Lagos, Lizbona, Aljezur)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root { --bg:#ffffff; --panel:#ffffff; --border:#e5e7eb; --text:#111827; --muted:#6b7280; --tag:#f3f4f6; --accent:#2563eb;}
    *{ box-sizing:border-box }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font:14px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;}
    #map { height:100vh; width:100%; }
    .panel {
      position: absolute; top: 12px; left: 12px; z-index: 1000;
      background: var(--panel); border:1px solid var(--border); border-radius: 12px;
      padding: 10px 12px; box-shadow: 0 6px 24px rgba(0,0,0,.08); max-width: 360px;
    }
    .panel h2 { margin: 0 0 6px; font-size: 16px; }
    .panel .sub { color: var(--muted); margin: 0 0 8px; font-size: 12px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:6px 12px; }
    .group { margin: 8px 0 4px; font-weight:600; font-size:12px; color:#374151; }
    label { display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none; }
    input[type="checkbox"]{ width:16px; height:16px; }
    .btns { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
    button {
      border:1px solid var(--border); background:#fff; border-radius:999px; padding:6px 10px; cursor:pointer;
      font-size:12px;
    }
    button:hover { box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .credit, .prices {
      position: absolute; left: 12px; z-index:1000;
      background: var(--panel); border:1px solid var(--border); border-radius: 12px;
      padding: 6px 8px; font-size: 12px; color: var(--muted);
    }
    .credit { bottom: 12px; }
    .prices { bottom: 68px; max-width: 360px;}
    .popup h3 { margin:0 0 6px; font-size:16px; }
    .popup p { margin:6px 0; }
    .tag { display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; background:var(--tag); margin-left:6px; }
    .gps { font-size:12px; color:var(--muted); margin-top:6px }
    .src a{ text-decoration:none }
    .src a:hover{ text-decoration:underline }
    .ok { color:#059669; font-weight:600 }
    .warn { color:#b45309; font-weight:600 }
    .pill { display:inline-flex; align-items:center; gap:6px; background:var(--tag); border-radius:999px; padding:2px 8px; font-size:12px; margin-right:6px;}
    .legend { position:absolute; right:12px; bottom:12px; z-index:1000; background:#fff; border:1px solid var(--border); border-radius:12px; padding:8px 10px; font-size:12px; color:#374151;}
    .legend .row{ display:flex; align-items:center; gap:6px; margin:4px 0}
    .dot{ width:10px; height:10px; border-radius:50%}
    .c-beach{ background:#60a5fa } .c-adv{ background:#22c55e } .c-cult{ background:#f59e0b } .c-night{ background:#a78bfa } .c-rest{ background:#ef4444 }
    @media (max-width:720px){
      .panel{ max-width: calc(100vw - 24px); right: 12px; }
      .grid{ grid-template-columns: 1fr 1fr; }
      .prices{ max-width: calc(100vw - 24px);}
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <aside class="panel">
    <h2>Filtry</h2>
    <p class="sub">Wybierz miasta i kategorie. Po zmianach kliknij „Dopasuj widok”.</p>

    <div class="group">Miasta</div>
    <div class="grid" id="city-filters">
      <label><input type="checkbox" data-city="Lagos" checked> Lagos</label>
      <label><input type="checkbox" data-city="Lizbona" checked> Lizbona</label>
      <label><input type="checkbox" data-city="Aljezur" checked> Aljezur</label>
    </div>

    <div class="group" style="margin-top:10px">Kategorie</div>
    <div class="grid" id="cat-filters">
      <label><input type="checkbox" data-cat="beach" checked> Plaże</label>
      <label><input type="checkbox" data-cat="adventure" checked> Woda & adrenalina</label>
      <label><input type="checkbox" data-cat="culture" checked> Zwiedzanie & historia</label>
      <label><input type="checkbox" data-cat="nightlife" checked> Nocne życie</label>
      <label><input type="checkbox" data-cat="restaurant" checked> Restauracje</label>
    </div>

    <div class="btns">
      <button id="btn-all">Zaznacz wszystko</button>
      <button id="btn-none">Odznacz wszystko</button>
      <button id="btn-fit">Dopasuj widok</button>
    </div>
  </aside>

  <div class="prices">
    <div style="font-weight:600; color:#374151; margin-bottom:4px">Średnia cena obiadu (miasto)</div>
    <div class="pill">Lagos: ok. <strong>€14.50</strong></div>
    <div class="pill">Lizbona: ok. <strong>€14.00</strong></div>
    <div class="pill">Aljezur (Algarve): ok. <strong>€13.68</strong></div>
    <div style="margin-top:4px">Źródło: Numbeo / Wise (wart. orientacyjne; sezon może podbijać ceny).</div>
  </div>

  <div class="credit">Mapa: © OpenStreetMap, Leaflet • Wskazówki i dane kontaktowe w opisach.</div>

  <div class="legend">
    <div class="row"><span class="dot c-beach"></span>Plaże</div>
    <div class="row"><span class="dot c-adv"></span>Woda & adrenalina</div>
    <div class="row"><span class="dot c-cult"></span>Zwiedzanie</div>
    <div class="row"><span class="dot c-night"></span>Nocne życie</div>
    <div class="row"><span class="dot c-rest"></span>Restauracje</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // === Inicjalizacja mapy ===
    const map = L.map('map', { zoomControl: true }).setView([37.2, -8.73], 8);
    const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution:'&copy; OpenStreetMap' }).addTo(map);
    L.control.scale({imperial:false}).addTo(map);

    // ikony kolorystyczne wg kategorii
    const iconColors = {
      beach: '#60a5fa', adventure: '#22c55e', culture: '#f59e0b', nightlife: '#a78bfa', restaurant: '#ef4444'
    };
    const baseIcon = (hex) => L.divIcon({
      className: 'custom-marker',
      html: `<div style="width:12px;height:12px;border-radius:50%;background:${hex};border:2px solid white;box-shadow:0 0 0 1px rgba(0,0,0,.25)"></div>`,
      iconSize: [14,14],
      iconAnchor: [7,7],
      popupAnchor: [0,-6],
    });

    // === Etykiety kategorii ===
    const CAT_LABEL = {
      beach: "Plaża",
      adventure: "Woda & adrenalina",
      culture: "Zwiedzanie",
      nightlife: "Nocne życie",
      restaurant: "Restauracja"
    };

    // === ATRAKCJE (z Twojego poprzedniego pliku) ===
    const attractions = [
      /* ============== LAGOS ============== */
      { city:"Lagos", name:"Ponta da Piedade (klifowy labirynt + latarnia)", lat:37.08062, lng:-8.66942, cat:"adventure",
        desc:"Najsłynniejsze klify Algarve: łuki skalne, groty, punkty widokowe i kładki.",
        links:[{label:"Info (przewodnik)",url:"https://www.lagosportugalguide.com/lagos-algarve/ponta-da-piedade-lagos.html"},{label:"Mapa",url:"https://mapcarta.com/W55432710"}],
        why:"Efekt WOW + trasy piesze i start kajaków/łodzi w okolicy." },
      { city:"Lagos", name:"Praia do Camilo", lat:37.08733, lng:-8.66843, cat:"beach",
        desc:"Ikoniczna plaża ze stromymi schodami i turkusową wodą.",
        links:[{label:"Opis (blog)",url:"https://www.zigzagonearth.com/praia-camilo-beach-lagos-portugal/"},{label:"Koordy",url:"https://mapcarta.com/33030320"}],
        why:"Świetne zdjęcia, zejście „pali” w nogi – klimat przygody." },
      { city:"Lagos", name:"Praia de Dona Ana", lat:37.091427, lng:-8.669362, cat:"beach",
        desc:"Duża, osłonięta plaża między Pinhão i Camilo – złote klify, łatwy dostęp.",
        links:[{label:"Info + GPS",url:"https://www.lagosportugalguide.com/lagos-algarve/Praia-Dona-Ana-lagos.html"}],
        why:"Bezpieczna baza wypadowa dla większej grupy." },
      { city:"Lagos", name:"Praia da Batata (start kajaków/SUP)", lat:37.0977806, lng:-8.6684444, cat:"adventure",
        desc:"Plaża u ujścia Bensafrim – częsty punkt startu kajaków do grot.",
        links:[{label:"Info",url:"https://www.lagosportugalguide.com/lagos-algarve/Praia-da-Batata-lagos.html"},{label:"Koordy",url:"https://visitalgarve.pt/en/equipamento/8725/praia-da-batata"}],
        why:"Idealna, by całą ekipą wsiąść w kajaki/SUP." },
      { city:"Lagos", name:"Meia Praia (sporty wodne)", lat:37.1106944, lng:-8.659675, cat:"adventure",
        desc:"4-km łuk piasku – kitesurf, żagle, gry zespołowe na plaży.",
        links:[{label:"Koordy",url:"https://euroveloportugal.com/en/poi/meia-praia-2"},{label:"Wiki",url:"https://en.wikipedia.org/wiki/Meia_Praia"}],
        why:"Dużo przestrzeni = luz dla 8 osób." },
      { city:"Lagos", name:"Praia do Porto de Mós (surf)", lat:37.085000, lng:-8.687778, cat:"adventure",
        desc:"Szeroka plaża na zachód od centrum, popularna dla surfujących.",
        links:[{label:"Opis/położenie",url:"https://www.beachrex.com/en/portugal/faro/lagos-beaches/praia-do-porto-de-mos"}],
        why:"Lekcje surfingu dla całej grupy lub free-surf." },
      { city:"Lagos", name:"Marina de Lagos — rejsy/groty/delfiny", lat:37.108619, lng:-8.673139, cat:"adventure",
        desc:"Punkt zbiórki na rejsy do grot Ponta da Piedade i wyprawy na delfiny.",
        links:[{label:"Punkt zbiórki",url:"https://www.theabroadguide.com/from-lagos-2-5-hour-guided-coastal-boat-tour-grotto-visit/"},{label:"Operator",url:"https://bluefleet.pt/en/lagos-portugal-tourist-information/"}],
        why:"Łatwa logistyka dla 8 osób, rejs to „pewniak”." },
      { city:"Lagos", name:"Forte da Ponta da Bandeira (XVII w.)", lat:37.099050, lng:-8.668270, cat:"culture",
        desc:"Fort u wejścia do portu – widoki na ujście i Batatę.",
        links:[{label:"Wiki",url:"https://en.wikipedia.org/wiki/Fort_of_Ponta_da_Bandeira"},{label:"VisitPortugal",url:"https://www.visitportugal.com/en/node/136430"}],
        why:"Szybki wtręt historyczny + foto-spot." },
      { city:"Lagos", name:"Parque Aventura Lagos (liny + paintball)", lat:37.1166859, lng:-8.6575933, cat:"adventure",
        desc:"Trasy w koronach drzew i paintball – adrenalina przy Meia Praia.",
        links:[{label:"Strona",url:"https://parqueaventura.net/lagos/"},{label:"Mapa",url:"https://mytripalgarve.com/place/parque-aventura-lagos/"}],
        why:"Team-bonding i rywalizacja dla ekipy." },
      { city:"Lagos", name:"Lagos Divers (centrum nurkowe)", lat:37.10646, lng:-8.67502, cat:"adventure",
        desc:"Kursy i nurkowania w okolicy Lagos.",
        links:[{label:"Info/kontakt",url:"https://www.zentacle.com/Shop.aspx?CountryId=196&StateId=185&CityId=1872&OrganizationId=16594"},{label:"Ulica/położenie",url:"https://mapcarta.com/W800176049"}],
        why:"Intro-dive dla „głębszych” wrażeń." },
      { city:"Lagos", name:"Rua 25 de Abril (bar-street / pub crawl)", lat:37.10181, lng:-8.67214, cat:"nightlife",
        desc:"Główna ulica nocnego życia – bary, kluby, muzyka na żywo.",
        links:[{label:"Przewodnik nocny",url:"https://www.hotels.com/go/portugal/best-nightlife-lagos"},{label:"Przykładowy bar",url:"https://www.bonvivantbarinlagos.com/"}],
        why:"Bar-hopping po intensywnym dniu." },
      { city:"Lagos", name:"Praia do Pinhão (mała „instagramowa” zatoczka)", lat:37.094419, lng:-8.668249, cat:"beach",
        desc:"Dzika plaża ze schodkami i widokowym klifem – blisko Dona Ana.",
        links:[{label:"Koordy + mapa",url:"https://www.playocean.net/en/portugal/lagos/beaches/praia-do-pinhao-beach"},{label:"Alternatywa",url:"https://euroveloportugal.com/en/poi/praia-do-pinhao-2"}],
        why:"Szybki wypad na foto/chill." },

      /* ============== LIZBONA ============== */
      { city:"Lizbona", name:"Bairro Alto (dzielnica barów)", lat:38.712753, lng:-9.146295, cat:"nightlife",
        desc:"Klubowo-barowe centrum nocnej Lizbony; puby, fado, rooftop-y.",
        links:[{label:"Opis/koordy",url:"https://www.latlong.net/place/bairro-alto-lisbon-portugal-25126.html"}],
        why:"Świetny start na wieczór dla 8-os. ekipy." },
      { city:"Lizbona", name:"Pink Street (Rua Nova do Carvalho)", lat:38.7072892, lng:-9.1438142, cat:"nightlife",
        desc:"Słynna „różowa ulica” w Cais do Sodré – kluby, bary, zdjęcia.",
        links:[{label:"Przewodnik",url:"https://www.lisbonportugaltourism.com/pl/lizbona/atrakcje/pink-street.html"}],
        why:"Kompaktowa strefa klubów – łatwo trzymać grupę razem." },
      { city:"Lizbona", name:"Time Out Market (Mercado da Ribeira)", lat:38.70709, lng:-9.1459, cat:"nightlife",
        desc:"Ogromna hala gastro: najlepsze stoiska i bary w mieście.",
        links:[{label:"Strona",url:"https://www.timeout.com/time-out-market-lisboa"}],
        why:"Wygodne „karmienie” dużej ekipy – każdy coś znajdzie." },
      { city:"Lizbona", name:"LX Factory", lat:38.703511, lng:-9.17882, cat:"nightlife",
        desc:"Postindustrialny kompleks: bary, street-food, koncerty, galerie.",
        links:[{label:"Strona",url:"https://lxfactory.com/en/"}],
        why:"Klimat + dużo przestrzeni dla grupy." },
      { city:"Lizbona", name:"Rejs/sunset na Tagu – Doca de Santo Amaro (Gate 3)", lat:38.69968, lng:-9.17605, cat:"adventure",
        desc:"Miejsce zbiórki na rejsy pod mostem 25 de Abril.",
        links:[{label:"Meeting point",url:"https://www.lisbonbyboat.com/meeting-point"}],
        why:"Wspólna łódź = integracja + widoki." },
      { city:"Lizbona", name:"Pilar 7 – 25 de Abril Bridge Experience", lat:38.699909, lng:-9.179541, cat:"adventure",
        desc:"Szklana platforma na filarze mostu 25 de Abril – hardcore’owy widok.",
        links:[{label:"Strona",url:"https://www.experienciapilar7.pt/en"}],
        why:"Dreszczyk i świetne foty." },
      { city:"Lizbona", name:"Torre de Belém", lat:38.691586, lng:-9.215977, cat:"culture",
        desc:"Ikoniczna wieża u ujścia Tagu; symbol epoki odkryć.",
        links:[{label:"Koordy",url:"https://www.latlong.net/place/the-belem-tower-lisbon-portugal-23126.html"}],
        why:"Obowiązkowy „must-see” blisko innych atrakcji Belém." },
      { city:"Lizbona", name:"Castelo de São Jorge", lat:38.713909, lng:-9.133476, cat:"culture",
        desc:"Średniowieczny zamek z panoramą na Alfamę i Tag.",
        links:[{label:"Koordy",url:"https://www.latlong.net/place/s-o-jorge-castle-lisbon-portugal-23127.html"}],
        why:"Historia + widoki – dobry dzienny kontrast do nocy." },
      { city:"Lizbona", name:"Miradouro da Senhora do Monte", lat:38.719186, lng:-9.132839, cat:"culture",
        desc:"Jeden z najwyższych punktów widokowych na Lizbonę.",
        links:[{label:"Koordy",url:"https://elevation.maplogs.com/poi/nossa_senhora_do_monte_belvedere_largo_monte_lisboa_portugal.321312.html"}],
        why:"Szybka, bezpłatna „wow-miejscówka”." },
      { city:"Lizbona", name:"Costa da Caparica – Praia do CDS (surf)", lat:38.645149, lng:-9.241793, cat:"adventure",
        desc:"Szeroka plaża surfowa na południe od mostu; szkoły surfingu.",
        links:[{label:"Blue Flag",url:"https://www.blueflag.global/awarded-sites/cds"}],
        why:"Łatwy dojazd + fale dla różnych poziomów." },

      /* ============== ALJEZUR ============== */
      { city:"Aljezur", name:"Praia da Arrifana", lat:37.29206, lng:-8.86546, cat:"beach",
        desc:"Słynna zatoka z klifami i „igłą” Pedra da Agulha; świetny surf.",
        links
